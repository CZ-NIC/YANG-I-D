YANG-I-D
========

This project provides a skeleton environment for individuals or teams
developing YANG data models and accompanying Internet-Drafts. The
included Makefile supports a typical workflow based on the following
assumptions:

* The source text of the I-D is written as XML using the
  [xml2rfc](http://greenbytes.de/tech/webdav/draft-reschke-xml2rfc-latest.html)
  format. Other source formats may be added later.
* The document describes a data model consisting of one or more YANG
  modules or submodules whose contents also appear in the I-D.
* A single XML instance document, such as a reply to NETCONF `<get>`
  message, is used for testing purposes and/or inclusion in the
  document.
* Additional files may contain any number of figures such as tree
  diagrams or ascii art. Such figures may be generated by a program or
  created by hand.

The Makefile implements validation of YANG modules and the instance
document, takes care about integrating the modules and other
external resources into the I-D, and producing the XML and text
formats ready for IETF submission.

In addition, common boilerplate texts, such as the description of
symbols in YANG tree diagrams, are defined as XML entities that can be
readily inserted in the I-D.

Fork a New Project Repository
---------------------------------

1. Go to the [YANG-I-D](https://github.com/llhotka/YANG-I-D) GitHub
   page and fork the project using the button at the top right.

2. Switch to the forked project and give it an appropriate name by
   renaming it in the Settings page.

3. Optionally, make [YANG-I-D](https://github.com/llhotka/YANG-I-D)
   into an _upstream_ for your project
   ([instructions](https://help.github.com/articles/fork-a-repo#step-3-configure-git-to-sync-your-fork-with-the-original-spoon-knife-repository)). This
   way you will be able to merge future updates to the Makefile and
   tools to the forked project.

Populate the Repository
-----------------------

Add YANG modules, I-D source, example XML instance of the data model
and figures (if any) and push them into the forked project
repository. Put everything into the main directory, do not create any
subdirectories.

Move (`git mv`) the file project-README.md to README.md and add all
necessary information about the project.

The Makefile has to be updated as follows:

* Set the `I_D` variable to the name of the Internet-Draft (without the
  revision number), and `REVNO` to the current revision number. The
  I-D source then should be in a file whose name is the value of `I_D`
  concatenated with the extension `.xml`.
  
* The `MODULES` variable should contain a space separated list of YANG
  modules and submodules that comprise the data model. Use only module
  names without the `.yang` extension.
  
* The `FIGURES` variable should contain names of files containing
  tree diagrams, code snippets or other ascii art.

* The variables `EXAMPLE_BASE` and `EXAMPLE_TYPE` together determine
  the file name and type of an example XML instance of the data model
  that is typically included in an appendix of the Internet-Draft. For
  example, if the XML document is a reply to the <get> message, the
  value of `EXAMPLE_TYPE` should be `get-reply`, and then, if the
  `EXAMPLE_BASE` is `example`, the XML document should be stored in
  the file `example-get-reply.xml`, or otherwise its name should be
  given as the value of the `EXAMPLE_INST` variable.

In general, Makefile variables with uppercase names may be adjusted
while those with lowercase names should not be changed (unless you
know what you are doing).

The Makefile may be extended with new rules, e.g. for generating tree
diagrams from the data model.

Quite often, other YANG modules that are not part of the current
project have to be added to the data model. Typically, if the current
project's modules augment other modules that already exist, then the
latter modules have to be added. This is accomplished by appending
their _capability string_ to the file `hello-external.ent`. The
correct capability string can be generated by the `capability`
output plugin of [pyang](https://code.google.com/p/pyang/). For
example, the capability string for the `ietf-ip` module can be
generated this way:

    $ pyang -f capability --capability-entity ietf-ip.yang 
      urn:ietf:params:xml:ns:yang:ietf-ip?module=ietf-ip&amp;revision=2014-03-28
	  &amp;features=ipv4-non-contiguous-netmasks,ipv6-privacy-autoconf

The capability string should then be appended to the
`hello-external.ent` file enclosed in `<capability>...</capability>`.

Internet-Draft Source
---------------------

The YANG-I-D repository contains a template for an Internet-Draft,
[draft.xml.template](https://github.com/llhotka/YANG-I-D/blob/master/draft.xml.template). The
easiest way to start writing the I-D is to copy this template to the
file `$(I_D).xml`, where `$(I_D)` denotes the value of the `I_D`
variable in the Makefile, and commit this file to git. The template
file contains instructions for integrating YANG modules and other
external entities into the I-D text.

The XML source of the I-D should follow the schema and
rules of
[xml2rfc](http://greenbytes.de/tech/webdav/draft-reschke-xml2rfc-latest.html). However,
this source should be revision independent so that it can be used
continually for all revisions. To achieve this, the `docName`
attribute should not be present – the name will be constructed automatically from the
`I_D` and `REVNO` Makefile variable.

The basic idea is that this revision-independent source is
automatically converted to a specific revision of the draft. Before
this conversion, all YANG modules, figures and the instance document
are wrapped in the `<artwork>` elements and saved in files with the
additional extension `.aw`. Contents of these files may then be
included in appropriate places of the I-D using XML entity
references. These external entities are defined in the files
`yang.ent` and `figures.ent` that are also generated by the
Makefile. See the file
[draft.xml.template](https://github.com/llhotka/YANG-I-D/blob/master/draft.xml.template)
for examples.

Running `make`
--------------

The revision of the Internet-Draft identified by the value of the
`REVNO` Makefile variable (both XML and text formats) is generated by
simply running

    $ make

This command also produces:

* `model.tree` file containing the tree diagram of the data model,
* DSDL schemas (RELAX NG, Schematron and DSRL) that can be used for
  validating the XML instance document.

Other useful Makefile targets are:

* `validate`: perform validation of the example XML instance document
  against the DSDL schemas.
* `rnc`: generate RELAX NG schema of the data model in the compact
  notation. This can be used, for example, with the Emacs
  [nXML](http://www.emacswiki.org/emacs/NxmlMode) mode.
* `clean`: remove all files generated by `make`.

Required Software
-----------------

The environment provided by YANG-I-D was designed for Unix-like
operating systems and tested on OS X and Linux. Instructions or
patches for other operating systems (Windows) are welcome.

Apart from the standard Mac/Linux system software (_GNU make_ and
_bash_), the following software packages have to be available:

* [Libxml2 suite](http://xmlsoft.org/), in particular _xmllint_ and
  _xsltproc_.
* [pyang](https://code.google.com/p/pyang/)
* [xml2rfc](http://xml2rfc.ietf.org/)

These Java tools are also recommended although not strictly necessary:

* [Jing](http://www.thaiopensource.com/relaxng/jing.html) – if you
  don't have it, remove the `-j` option in the `validate` target's
  action, and _xmllint_ will be used instead.
* [Trang](http://www.thaiopensource.com/relaxng/trang.html) – needed
  only for the `rnc` target.
